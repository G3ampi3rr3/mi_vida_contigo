<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Camera Test</title>

    <!-- Primero carga Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

    <!-- Luego carga AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/three.js/build/ar-threex.js"></script>

    <style>
      body, html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: black;
      }
    </style>
  </head>

  <body>
    <script>
      window.onload = () => {
        // Crear escena
        const scene = new THREE.Scene();

        // CÃ¡mara
        const camera = new THREE.Camera();
        scene.add(camera);

        // Renderizador
        const renderer = new THREE.WebGLRenderer({
          antialias: true,
          alpha: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // AR Toolkit - Fuente (webcam)
        const arToolkitSource = new THREEx.ArToolkitSource({
          sourceType: "webcam",
        });

        arToolkitSource.init(() => {
          setTimeout(() => {
            arToolkitSource.onResize(renderer.domElement);
          }, 200);
        });

        // AR Toolkit - Contexto
        const arToolkitContext = new THREEx.ArToolkitContext({
          cameraParametersUrl:
            "https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/three.js/data/camera_para.dat",
          detectionMode: "mono",
        });

        arToolkitContext.init(() => {
          camera.projectionMatrix.copy(
            arToolkitContext.getProjectionMatrix()
          );
        });

        // Loop
        function animate() {
          requestAnimationFrame(animate);

          if (arToolkitSource.ready) {
            arToolkitContext.update(arToolkitSource.domElement);
          }

          renderer.render(scene, camera);
        }

        animate();
      };
    </script>
  </body>
</html>
